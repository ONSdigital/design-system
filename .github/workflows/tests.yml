name: Run tests
on: [pull_request]
jobs:
  - name: Unit and visual tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Install Node
        uses: actions/setup-node@v2
        with:
          node-version: '14'
      - name: Run unit tests
        run: yarn test
      - name: Run visual regression tests
        if: commit_message =~ /(test-visual)/
        run: yarn test-visual
      - name: Design System tests notification
        if: always()
        uses: edge/simple-slack-notify@master
          with:
            channel: '#pat-lib-notifications'
            status: ${{ job.status }}
            success_text: '${env.GITHUB_WORKFLOW} (${env.GITHUB_RUN_NUMBER}) build completed successfully'
            failure_text: '${env.GITHUB_WORKFLOW} (${env.GITHUB_RUN_NUMBER}) build failed'
            cancelled_text: '${env.GITHUB_WORKFLOW} (${env.GITHUB_RUN_NUMBER}) build was cancelled'
            fields: |
              [{ "title": "Repository", "value": "${env.GITHUB_REPOSITORY}", "short": true },
              { "title": "Branch", "value": "${env.BRANCH}", "short": true }]

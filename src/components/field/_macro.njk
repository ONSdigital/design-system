{% from "components/error/_macro.njk" import onsError %}

{% macro onsField(params) %}
    {% if not params %}
        {% set params = {} %}
    {% endif %}

    {% set field %}
        {# Resolves caller issue in jijna: https://github.com/pallets/jinja/issues/371 #}
        {% set content = caller() %}

        {% if params.error %}
            {% call onsError(params.error) %}
                {{ content | safe }}
            {% endcall %}
        {% else %}
            {{ content | safe }}
        {% endif %}
    {% endset %}

    {% if params.dontWrap %}
        {{ field | safe }}
    {% else %}
        <p 
            {% if params.id %}id="{{ params.id }}"{% endif %}
            class="field"
            {% if params.attributes %}{% for attribute, value in (params.attributes.items() if params.attributes is mapping and params.attributes.items else params.attributes) %}{{ attribute }}{% if value %}="{{ value }}"{% endif %} {% endfor %}{% endif %}
        >
            {{ field | safe }}
        </p>
    {% endif %}
{% endmacro %}
